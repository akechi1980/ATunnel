/**
 *   TunnelUtils 
 */
import * as crypto from 'crypto';
import * as zlib from 'zlib';

export class TunnelUtils{


    encode(inbuf: Buffer,method: any,pass : String) {
        try{
            var cipher = crypto.createCipher(method, pass);
            var encrypted = cipher.update(inbuf);
            // encrypted = cipher.final();
            encrypted = Buffer.concat([encrypted, cipher.final()]);
        }catch(e){
            console.log(e.message);
        }
    
        return encrypted;
    }

    decode(inbuf: Buffer,method: any,pass : String) {
        try{
            var decipher = crypto.createDecipher(method, pass);
            var encrypted = decipher.update(inbuf);
            encrypted = Buffer.concat([encrypted, decipher.final()]);
        }catch(e){
            console.log(e.message);
        }
        return encrypted;
    }

    //压缩
    zip(inbuf) {
        try{
            var encrypted = zlib.gzipSync(inbuf);
        }catch(e){
            console.log(e.message);
        }
    
        return encrypted;
    }

    unzip(inbuf) {
        try{
            var encrypted = zlib.gunzipSync(inbuf);       
        }catch(e){
            console.log(e.message);
        }
        return encrypted;
    }

}


//TESTCode
let test = new TunnelUtils();
var testBuf : Buffer = Buffer.from('JustTest');
console.log(test.decode(test.encode(testBuf,'aes192', '123'),'aes192', '123').toString());
console.log(test.unzip(test.zip(testBuf)).toString());
