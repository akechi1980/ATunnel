/**
 *   TunnelUtils 
 */
import * as crypto from 'crypto';
import * as zlib from 'zlib';

export class TunnelUtils{

    //............encode............
    public static encode(inbuf: Buffer,method: any,pass : String) {
        try{
            var cipher = crypto.createCipher(method, pass);
            var encrypted = cipher.update(inbuf);
            // encrypted = cipher.final();
            encrypted = Buffer.concat([encrypted, cipher.final()]);
        }catch(e){
            console.log(e.message);
        }
    
        return encrypted;
    }

    //............unzip............
    public static decode(inbuf: Buffer,method: any,pass : String) {
        try{
            var decipher = crypto.createDecipher(method, pass);
            var encrypted = decipher.update(inbuf);
            encrypted = Buffer.concat([encrypted, decipher.final()]);
        }catch(e){
            console.log(e.message);
        }
        return encrypted;
    }

    //............zip............
    public static zip(inbuf) {
        try{
            var encrypted = zlib.gzipSync(inbuf);
        }catch(e){
            console.log(e.message);
        }
    
        return encrypted;
    }

    //............unzip............
    public static unzip(inbuf) {
        try{
            var encrypted = zlib.gunzipSync(inbuf);       
        }catch(e){
            console.log(e.message);
        }
        return encrypted;
    }

}


//TESTCode
var testBuf : Buffer = Buffer.from('JustTest');
console.log(TunnelUtils.decode(TunnelUtils.encode(testBuf,'aes192', '123'),'aes192', '123').toString());
console.log(TunnelUtils.unzip(TunnelUtils.zip(testBuf)).toString());
